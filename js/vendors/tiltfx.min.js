(function(k){function p(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a}function u(a,b){var d=!0;return function(e){d&&(d=!1,setTimeout(function(){d=!0},b),a(e))}}function f(a,b){a&&(this.el=a,this.options=p({},this.options),p(this.options,b),this._init(),this._initEvents())}for(var q=0,r=["webkit","moz","ms","o"],g=k.requestAnimationFrame,h=k.cancelAnimationFrame,l,m=0;m<r.length&&(!g||!h);m++)l=r[m],g=g||k[l+"RequestAnimationFrame"],h=h||k[l+"CancelAnimationFrame"]||k[l+"CancelRequestAnimationFrame"];
g&&h||(g=function(a,b){var d=(new Date).getTime(),e=Math.max(0,16-(d-q)),c=k.setTimeout(function(){a(d+e)},e);q=d+e;return c},h=function(a){k.clearTimeout(a)});f.prototype.options={extraImgs:2,extraImgsScaleGrade:0,opacity:.7,customImgsOpacity:!1,bgfixed:!0,resetOnLeave:!0,movement:{perspective:1E3,translateX:-10,translateY:-10,translateZ:20,rotateX:2,rotateY:2,rotateZ:0},element:{mouseMoveWatcher:null,viewWatcher:null}};f.prototype._init=function(){this.tiltWrapper=document.createElement("div");
this.tiltWrapper.className="tilt";this.tiltImgBack=document.createElement("div");this.tiltImgBack.className="tilt__back";this.tiltImgBack.tiltFxType="back";this.tiltImgBack.style.backgroundImage="url("+this.el.src+")";this.tiltWrapper.appendChild(this.tiltImgBack);this.imgCount=1>this.options.extraImgs?0:64<this.options.extraImgs?64:this.options.extraImgs;this.options.movement.perspective||(this.options.movement.perspective=0);this.imgElems=[];var a=this.imgCount;this.options.bgfixed||(this.imgElems.push(this.tiltImgBack),
++this.imgCount);for(var b=0;b<a;++b){var d=document.createElement("div");d.className="tilt__front";d.style.backgroundImage="url("+this.el.src+")";this.tiltWrapper.appendChild(d);this.imgElems.push(d)}this._initSetImagesOpacity();this.el.parentNode.insertBefore(this.tiltWrapper,this.el);this.el.parentNode.removeChild(this.el);this._setViewWatcher(this);this._setMouseMoveWatcher(this);this._calcView(this)};f.prototype._initSetImagesOpacity=function(){if(this.options.customImgsOpacity)for(var a=0,b=
this.imgElems.length;a<b;++a)this.imgElems[a].style.opacity=this.options.customImgsOpacity[a]?this.options.customImgsOpacity[a]:this.options.opacity;else for(a=0,b=this.imgElems.length;a<b;++a)"back"!==this.imgElems[a].tiltFxType&&(this.imgElems[a].style.opacity=this.options.opacity)};f.prototype._calcView=function(a){a.view={width:a.viewWatcher.offsetWidth,height:a.viewWatcher.offsetHeight}};f.prototype._setMouseMoveWatcher=function(a){var b=!1;a.options.element&&a.options.element.mouseMoveWatcher&&
(b=document.querySelector(a.options.element.mouseMoveWatcher),a.mouseMoveWatcher=b,b=!0);b||(a.mouseMoveWatcher=a.viewWatcher)};f.prototype._setViewWatcher=function(a){var b=!1;if(a.options.element&&a.options.element.viewWatcher){var d=document.querySelector(a.options.element.viewWatcher);d&&(a.viewWatcher=d,b=!0)}b||(a.viewWatcher=a.tiltWrapper)};f.prototype._initEvents=function(){var a=this,b=a.options.movement;a.mouseMoveWatcher.addEventListener("mousemove",function(d){g(function(){var e=d;var c=
0;var f=0;e||(e=k.event);if(e.pageX||e.pageY)c=e.pageX,f=e.pageY;else if(e.clientX||e.clientY)c=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;e=c;var g=document.body.scrollLeft+document.documentElement.scrollLeft;c=document.body.scrollTop+document.documentElement.scrollTop;var h=a.tiltWrapper.getBoundingClientRect();e=e-h.left-g;f=f-h.top-c;c=0;for(h=a.imgElems.length;c<h;++c){g=a.imgElems[c];var l=b.rotateX?
(c+1)*b.rotateX/a.imgCount*2/a.view.height*f-(c+1)*b.rotateX/a.imgCount:0,m=b.rotateY?(c+1)*b.rotateY/a.imgCount*2/a.view.width*e-(c+1)*b.rotateY/a.imgCount:0,p=b.rotateZ?(c+1)*b.rotateZ/a.imgCount*2/a.view.width*e-(c+1)*b.rotateZ/a.imgCount:0,q=b.translateX?(c+1)*b.translateX/a.imgCount*2/a.view.width*e-(c+1)*b.translateX/a.imgCount:0,r=b.translateY?(c+1)*b.translateY/a.imgCount*2/a.view.height*f-(c+1)*b.translateY/a.imgCount:0,t=b.translateZ?(c+1)*b.translateZ/a.imgCount*2/a.view.height*f-(c+1)*
b.translateZ/a.imgCount:0,n=1+a.options.extraImgsScaleGrade*(h-(c+1));n=1!==n?" scale("+n+", "+n+")":"";g.style.WebkitTransform="perspective("+b.perspective+"px) translate3d("+q+"px,"+r+"px,"+t+"px) rotate3d(1,0,0,"+l+"deg) rotate3d(0,1,0,"+m+"deg) rotate3d(0,0,1,"+p+"deg)"+n;g.style.transform="perspective("+b.perspective+"px) translate3d("+q+"px,"+r+"px,"+t+"px) rotate3d(1,0,0,"+l+"deg) rotate3d(0,1,0,"+m+"deg) rotate3d(0,0,1,"+p+"deg)"+n}})});a.options.resetOnLeave&&a.mouseMoveWatcher.addEventListener("mouseleave",
function(){setTimeout(function(){for(var d=0,e=a.imgElems.length;d<e;++d){var c=a.imgElems[d];c.style.WebkitTransform="perspective("+b.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)";c.style.transform="perspective("+b.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)"}},60)});k.addEventListener("resize",u(function(){a._calcView(a)},50))};f.prototype.init=function(){[].slice.call(document.querySelectorAll("img.tilt-effect")).forEach(function(a){new f(a,JSON.parse(a.getAttribute("data-tilt-options")))})};
(new f).init();k.TiltFx=f})(window);
